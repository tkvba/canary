kind: pipeline
name: default

steps:
- name: build
  image: nginx
  commands:
  - echo "inside container"
  
- name: publish
  image: plugins/ecr
  settings:
    access_key: AKIA3B4U6ZRO63IEEKZB
    secret_key: 
      from_secret: p_aws
    repo: tkrepo
    registry: 759984737373.dkr.ecr.us-west-2.amazonaws.com
    region: us-west-2
    tag:
    - canary_v"${DRONE_BUILD_NUMBER}"
  when:
    event:
    - push
